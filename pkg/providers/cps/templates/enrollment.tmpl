{{- /*gotype: github.com/akamai/cli-terraform/pkg/providers/cps.TFCPSData*/ -}}
terraform {
  required_providers {
    akamai = {
      source  = "akamai/akamai"
      version = ">= 2.0.0"
    }
  }
  required_version = ">= 0.13"
}

provider "akamai" {
  edgerc         = var.edgerc_path
  config_section = var.config_section
}
{{$data := .}}
{{- with .Enrollment}}
    resource "akamai_cps_dv_enrollment" "enrollment_id_{{$data.EnrollmentID}}" {
    {{- $cn := .CSR.CN}}
    common_name = "{{$cn}}"
    {{- if $data.AllowDuplicateCommonName}}
        allow_duplicate_common_name = {{$data.AllowDuplicateCommonName}}
    {{- end}}
    {{- if .CSR.SANS}}
        sans = [{{range .CSR.SANS}}{{if ne $cn .}}"{{.}}", {{end}}{{end}}]
    {{- end}}
    secure_network = "{{.NetworkConfiguration.SecureNetwork}}"
    sni_only       = {{.NetworkConfiguration.SNIOnly}}
    {{- if $data.AcknowledgePreVerificationWarnings}}
        acknowledge_pre_verification_warnings = {{$data.AcknowledgePreVerificationWarnings}}
    {{- end}}
    {{- with .AdminContact}}
        admin_contact {
        first_name       = "{{.FirstName}}"
        last_name        = "{{.LastName}}"
        {{- if .Title}}
            title            = "{{.Title}}"
        {{- end}}
        organization     = "{{.OrganizationName}}"
        email            = "{{.Email}}"
        phone            = "{{.Phone}}"
        address_line_one = "{{.AddressLineOne}}"
        {{- if .AddressLineTwo}}
            address_line_two = "{{.AddressLineTwo}}"
        {{- end}}
        city             = "{{.City}}"
        region           = "{{.Region}}"
        postal_code      = "{{.PostalCode}}"
        country_code     = "{{.Country}}"
        }
    {{- end}}
    {{- if .CertificateChainType}}
        certificate_chain_type = "{{.CertificateChainType}}"
    {{- end}}
    {{- with .CSR}}
        csr {
        country_code        = "{{.C}}"
        city                = "{{.L}}"
        organization        = "{{.O}}"
        organizational_unit = "{{.OU}}"
        state               = "{{.ST}}"
        }
    {{- end}}
    {{- if .EnableMultiStackedCertificates}}
        enable_multi_stacked_certificates = {{.EnableMultiStackedCertificates}}
    {{- end}}
    {{- with .NetworkConfiguration}}
        network_configuration {
        {{- with .ClientMutualAuthentication}}
            client_mutual_authentication {
            {{- if .AuthenticationOptions.SendCAListToClient}}
                send_ca_list_to_client  = {{.AuthenticationOptions.SendCAListToClient}}
            {{- end}}
            {{- if .AuthenticationOptions.OCSP.Enabled}}
                ocsp_enabled            = {{.AuthenticationOptions.OCSP.Enabled}}
            {{- end}}
            {{- if .SetID}}
                set_id                  = "{{.SetID}}"
            {{- end}}
            }
        {{- end}}
        {{- if .DisallowedTLSVersions}}
            disallowed_tls_versions = [{{range .DisallowedTLSVersions}}"{{.}}",{{end}}]
        {{- end}}
        {{- if .DNSNameSettings.CloneDNSNames}}
            clone_dns_names         = {{.DNSNameSettings.CloneDNSNames}}
        {{- end}}
        geography               = "{{.Geography}}"
        {{- if .MustHaveCiphers}}
            must_have_ciphers       = "{{.MustHaveCiphers}}"
        {{- end}}
        {{- if .OCSPStapling}}
            ocsp_stapling           = "{{.OCSPStapling}}"
        {{- end}}
        {{- if .PreferredCiphers}}
            preferred_ciphers       = "{{.PreferredCiphers}}"
        {{- end}}
        {{- if .QuicEnabled}}
            quic_enabled            = {{.QuicEnabled}}
        {{- end}}
        }
    {{- end}}
    signature_algorithm = "{{.SignatureAlgorithm}}"
    {{- with .TechContact}}
        tech_contact {
        first_name       = "{{.FirstName}}"
        last_name        = "{{.LastName}}"
        {{- if .Title}}
            title            = "{{.Title}}"
        {{- end}}
        organization     = "{{.OrganizationName}}"
        email            = "{{.Email}}"
        phone            = "{{.Phone}}"
        address_line_one = "{{.AddressLineOne}}"
        {{- if .AddressLineTwo}}
            address_line_two = "{{.AddressLineTwo}}"
        {{- end}}
        city             = "{{.City}}"
        region           = "{{.Region}}"
        postal_code      = "{{.PostalCode}}"
        country_code     = "{{.Country}}"
        }
    {{- end}}
    {{- with .Org}}
        organization {
        name             = "{{.Name}}"
        phone            = "{{.Phone}}"
        address_line_one = "{{.AddressLineOne}}"
        {{- if .AddressLineTwo}}
            address_line_two = "{{.AddressLineTwo}}"
        {{- end}}
        city             = "{{.City}}"
        region           = "{{.Region}}"
        postal_code      = "{{.PostalCode}}"
        country_code     = "{{.Country}}"
        }
    {{- end}}
    contract_id = "{{$data.ContractID}}"
    }
{{- end}}